<!DOCTYPE HTML>
<html>
	<head>
		<title>poObject.h</title>
		<link rel="stylesheet" href="" />
		<link href="css/reset.css" media="screen" rel="stylesheet" type="text/css" media="screen, projection" />
		<link href="css/parse.css" media="screen" rel="stylesheet" type="text/css" media="screen, projection" />
		<link href='http://fonts.googleapis.com/css?family=Gentium+Basic:400,700' rel='stylesheet' type='text/css'>
	</head>
	
	<body>
		<header>
			<h1>poObject.h</h1>
		</header>

		<div id= "content">	
			
		      	<section class="section">
					<div class="comments">
						<p><p>
					</div>
					
					<div class="code">
						<pre>/*
*  Copyright 2011 Potion Design. All rights reserved.
*/

#pragma once

#include &quot;poTween.h&quot;
#include &quot;poEvent.h&quot;
#include &quot;poDictionary.h&quot;
#include &quot;poMatrixSet.h&quot;
#include &quot;poMatrixStack.h&quot;
#include &quot;poEnums.h&quot;
#include &quot;poPoint.h&quot;
#include &quot;poColor.h&quot;
#include &quot;poRect.h&quot;
#include &quot;poObjectModifier.h&quot;
#include &quot;poXML.h&quot;

class poObject;
typedef std::vector&lt;poObject*&gt; poObjectVec;

class poObjectModifier;
typedef std::vector&lt;poObjectModifier*&gt; poObjectModifierVec;

class poWindow;

/*! \class poObject
\brief poObject is the central object in the potionCode library. All potionCode graphic objects(including poShape2D, poRectShape and poTextBox) are subclasses of poObject. &lt;a href=&quot;http://www.potiondesign.com&quot;&gt;Pocode wiki&lt;/a&gt;.

All poObjects and poObject subclasses:

+ Have position, scale, rotation, offset and tranparency (alpha) properties.&lt;br&gt;
+ Have a list of children that are also poObjects (this forms the scene graph).&lt;br&gt;
+ Can register for and receive events, including mouse, keyboard and touch events.&lt;br&gt;
+ Have a set of tweens for basic animation (animation may also be done in the &quot;update&quot; method).&lt;br&gt;
+ Have a list of poObjectModifiers that can modify the object and/or OpenGl state.&lt;br&gt;
*/



class poObject : public boost::noncopyable
{
friend class poWindow;
public:

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>!

<p>
					</div>
					
					<div class="code">
						<pre>/** @name OBJECT CREATION AND DESTRUCTION */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>poObject();
poObject(const std::string &amp;name);
virtual             ~poObject();

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/*! Most poObject subclasses should implement all four of these methods.
The only method you should call explictly is messageHandler. The other three are called automatically
if the object is added to the scene graph. 
*/
/** @name WORK-HORSE METHODS */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

!"draw" is only necessary if the class does its own OpenGL drawing, instead of using potionCode shapes.

<p>
					</div>
					
					<div class="code">
						<pre>virtual void        draw();

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>!"update" is called once per frame. It should be used for implementing animation.

<p>
					</div>
					
					<div class="code">
						<pre>virtual void        update();

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>!"eventHandler" is called when the object receives an event. Events are registered using "addEvent".<br>

<p>
					</div>
					
					<div class="code">
						<pre>virtual void        eventHandler(poEvent *event);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>!"messageHander" is a general utility method used for passing messages between any two poObjects.<br>

<p>
					</div>
					
					<div class="code">
						<pre>virtual void        messageHandler(const std::string &amp;msg, const poDictionary&amp; dict=poDictionary());

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/*! All events are registed using &quot;addEvent&quot;. See &quot;poEnums.h&quot; for a list of all eventTypes.*/
/** @name EVENTS */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>int                 addEvent(int eventType, poObject *sink, std::string message=&quot;&quot;, const poDictionary&amp; dict=poDictionary());
void                removeEvent(int event_id);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/*! The scene graph is a tree structure composed of poObjects and subclasses of poObject.
A potionCode app is itself a poObject and is also the root of the tree.
The most recently added objects appear on top of previously added objects.
*/
/** @name SCENE GRAPH COMPOSITION*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>int                 numChildren() const;
template &lt;typename T&gt;
T*                  addChild(T* obj);
template &lt;typename T&gt;
T*                  addChild(T* obj, int idx); 
template &lt;typename T, typename TT&gt;
T*                  addChildBefore(T* obj, TT* before);
template &lt;typename T, typename TT&gt;
T*                  addChildAfter(T* obj, TT* after);
int                 getChildIndex(poObject* child);
poObject*           getChild(int at_idx);
poObject*           getChildWithUID(uint uid);
poObject*           getChild(const std::string &amp;with_name);
poObject*           getLastChild();
template &lt;typename T&gt; 
T*                  getChildAs(int idx);
template &lt;typename T&gt;
T*                  getChildAs(const std::string &amp;name);
template &lt;typename T&gt;
T*                  getLastChildAs();
bool                removeChild(poObject* obj);
bool                removeChild(int at_idx, bool and_delete=true);
void                removeAllChildren(bool and_delete=true);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/** @name SCENE GRAPH ORDERING*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>void                moveChildToFront(poObject* child);
void                moveChildToBack(poObject* child);
void                moveChildForward(poObject* child);
void                moveChildBackward(poObject* child);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/*! poObject modifiers attach to a poObject and may modify it's properties.
poObjectModifiers have two virtual methods, doSetUp and doSetDown
that are called, respectively, before and afer a poObject is drawn.
*/
/** @name OBJECT MODIFIER OPERATIONS*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>template &lt;typename T&gt;
T*                  addModifier(T* mod);
template &lt;typename T&gt;
T*                  getModifier(int idx);
bool                removeModifier(int idx, bool and_delete=true);
bool                removeModifier(poObjectModifier* mod, bool and_delete=true);
void                removeAllModifiers(bool and_delete=true);
int                 numModifiers() const;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/*!pointInside assumes points are in window-native coordinates (0,0 is in the upper left).&lt;br&gt;
globalToLocal and localToGlobal are useful in hitTesting and inter-object coordination.*/
/** @name HIT TESTING &amp; COORDINATE TRANSFORMATIONS*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>virtual bool        pointInside(poPoint point, bool localize=false);
bool                pointInside(float x, float y, float z=0.f, bool localize=false);
poPoint             objectToLocal(poObject* obj, poPoint point) const;
poPoint             globalToLocal(poPoint point) const;
poPoint             localToGlobal(poPoint point) const;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/** @name OBJECT ALIGNMENT &amp; BOUNDS CALCULATION*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>poAlignment         alignment() const;
virtual poObject&amp;   alignment(poAlignment align);
virtual poRect      calculateBounds();

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/** @name TWEEN MANAGEMENT*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{    

<p>
					</div>
					
					<div class="code">
						<pre>virtual void        stopAllTweens(bool recurse=false);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/*! Parent object should pass the child's poXMLNode node into the child.*/
/** @name OBJECT SERIALIZATION */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>virtual void        read(poXMLNode node);
virtual void        write(poXMLNode &amp;node);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>
/** @name SCENE GRAPH TRAVERSAL (DO NOT CALL) */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>void                _drawTree();
void                _updateTree();
void                _broadcastEvent(poEvent* event);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/*! These properties may be set directly either inside or outside the class.
Changes to these properties require no additional computation.*/
/** @name OBJECT PROPERTIES (DIRECTLY ACCESSIBLE) */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>std::string         name;
float               alpha;
poPoint             scale;
poPoint             position;
float               rotation;
poPoint             rotationAxis;
poPoint             offset;
poRect              bounds;
bool                visible;
bool                boundsAreFixed;
poMatrixOrder       matrixOrder;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/* All poObjects have tween operators that may be enabled and disabled independently.
By default, all tweens are disabled. See poTween.h for more about tweens.*/
/** @name OBJECT TWEENS (DIRECTLY ACCESSIBLE) */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{   

<p>
					</div>
					
					<div class="code">
						<pre>poTween&lt;poPoint&gt;	position_tween;
poTween&lt;poPoint&gt;	scale_tween;
poTween&lt;poPoint&gt;	offset_tween;
poTween&lt;float&gt;		alpha_tween;
poTween&lt;float&gt;		rotation_tween;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

/** @name OBJECT PROPERTIES (PROTECTED) */

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{  

<p>
					</div>
					
					<div class="code">
						<pre>poObject*           parent() const;
uint                uid() const;
bool                isInWindow() const;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>!alpha with parent alpha pre-multiplied

<p>
					</div>
					
					<div class="code">
						<pre>float               appliedAlpha() const; 	
poMatrixSet         matrixSet() const;
int                 drawOrder() const;

static const int    INVALID_INDEX = -1;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>

protected:
/** @name PROTECTED PROPERTIES*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>virtual void        updateAllTweens();//new tween types should be updated here
float               true_alpha; 	//combination of all your parent's alphas with your own

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}     

<p>
					</div>
					
					<div class="code">
						<pre>
private:
/*! These matrix operators not only push and pop the matrix, but also maintain
the alpha stack and data required by the event handling system.*/
/** @name COORDINATE SYSTEM OPERATIONS*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>void                pushObjectMatrix();
void                popObjectMatrix();
void                localizeEvent(poEvent*, poEvent*, poPoint);
void                inWindow(bool b);

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>
/*! &quot;children&quot; is a vector of poObjects. It is the basis for the poObject scene graph/tree structure.
Every poObject that has been added as child has a parent. Be careful not to access the parent
in a poObject constructor, since it will not have one yet.*/
/** @name CHILDREN, PARENT AND MODIFIERS*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>poObjectVec         children;
poObject*           _parent;
poObjectModifierVec modifiers;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>
/** @name PRIVATE PROPERTIES*/

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@{

<p>
					</div>
					
					<div class="code">
						<pre>uint                _uid;
poAlignment         _alignment;

poMatrixSet         matrices;
int                 draw_order;
bool                in_window;

				</section>
		    
		      	<section class="section">
					<div class="comments">
						<p>@}

<p>
					</div>
					
					<div class="code">
						<pre>};


/*! THESE METHODS MUST BE PLACED HERE INSTEAD OF THE CPP FILES, BECAUSE THEY ARE TEMPLATED.*/

template &lt;typename T&gt;
T* poObject::addChild(T* obj) {
return addChild(obj, children.size());
}

template &lt;typename T&gt;
T* poObject::addChild(T* obj, int idx) {
if(obj-&gt;_parent) {
obj-&gt;_parent-&gt;removeChild(obj);
}

obj-&gt;_parent = this;
obj-&gt;inWindow(in_window);
children.insert(children.begin()+idx, obj);

return obj;
}

template &lt;typename T, typename TT&gt;
T* poObject::addChildBefore(T* obj, TT* before) {
int idx = getChildIndex(before);
idx = (idx &lt;= 0) ? 0 : idx -;
return addChild(obj, idx);
}

template &lt;typename T, typename TT&gt;
T* poObject::addChildAfter(T* obj, TT* after) {
int idx = getChildIndex(after);
return addChild(obj, idx);
}

template &lt;typename T&gt;
T* poObject::getChildAs(int idx) {
return static_cast&lt;T*&gt;(getChild(idx));
}
template &lt;typename T&gt;
T* poObject::getChildAs(const std::string &amp;name) {
return static_cast&lt;T*&gt;(getChild(name));
}
template &lt;typename T&gt;
T* poObject::getLastChildAs() {
return static_cast&lt;T*&gt;(getLastChild());
}

template &lt;typename T&gt;
T* poObject::addModifier(T* mod)
{
modifiers.push_back( mod );
return mod;
}
template &lt;typename T&gt;
T* poObject::getModifier(int idx) {
return static_cast&lt;T*&gt;(modifiers[idx]);
}



				</section>
		    
			
		
		</div><!-- /#content -->

	</body>
</html>